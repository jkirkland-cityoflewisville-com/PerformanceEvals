<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">

    <title>Evals - Self Assessments</title>
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="theme-color" content="#ffffff">

    <!-- styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Product+Sans:400,400i,700,700i" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Product+Sans:400,400i,700,700i" rel="stylesheet" type="text/css">

    <!-- materialize -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!--VueJS-->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style> 
    </style>
</head>
<body style="background-color:whitesmoke;">
    
    <div id="app" v-cloak>
        <div class="navbar">
            <nav>
                <div class="nav-wrapper deep-purple white-text">
                    <a class="brand-logo">&nbsp Evaluation Forms</a>
                </div>
            </nav>
        </div> <!--end navbar-->
        <div class="row">
            <div class="col s12">
                {{username}}
            </div>
        </div>
        <br>
        <br>

        <div class="container white" style="height: calc(100vh - 105px); padding:1.5em;">

            <!--Form Types-->
            <div class="row">
                <div class="col s12 center-align">
                    <a class="waves-effect waves-light btn" @click="formType='accomplishments'; getRecords('accomplishments')" :class="{'blue': formType=='accomplishments'}">Accomplishments</a>
                    <a class="waves-effect waves-light btn" @click="formType='self_assessments'; getRecords('self_assessments')" :class="{'blue': formType=='self_assessments'}">Self Assessments</a>
                    <a class="waves-effect waves-light btn" @click="formType='evaluations'; getRecords('evaluations')" :class="{'blue': formType=='evaluations'}">Evaluations</a>
                    <a class="waves-effect waves-light btn" @click="formType='supervisor_logs'; getRecords('supervisor_logs')" :class="{'blue': formType=='supervisor_logs'}">Supervisor Logs</a>
                </div>
            </div>         
            
            <!--Records Loading-->
            <div class="row" v-show="recordsAreLoading == true">
                <div class="col s12 center-align">
                    Loading...
                </div>
            </div>

            <!--No records found-->
            <div class="row" v-show="noRecordsFound == true">
                    <div class="col s12 center-align">
                        No Records Found
                    </div>
                </div>

            <!--Records-->
            <div class="row" v-show="records.length > 0">
                <div class="col s12">
                    <h4>{{formTypePretty}}</h4>
                    <div class="row" v-for="record in records">
                        <div class="col s12">
                            <a :href="record.link">{{record.EmployeeName}} <span v-if="formType=='self_assessments' || formType=='evaluations'"> | {{formatDate(record.Evaluation_Period_Start_Date)}} to {{formatDate(record.Evaluation_Period_End_Date)}}</span></a>
                        </div>                        
                        <div class="col s12"><hr></div>
                    </div>
                </div>
            </div>
            
        </div> <!--end container-->

    </div>  <!--end app-->


    <!--Javascript-->
    <script>
        "use strict"

        var app = new Vue({
            el: "#app",
            data: {
                records: [],
                recordsAreLoading: false,
                noRecordsFound: false,
                formType: "",
                username: ''
            },
            methods: {
                init: function(){
                    var _this = this
                    _this.username = localStorage.colEmail
                },
                getRecords: function(_formType){
                    var _this = this

                    //Reset variables
                    _this.records.length = 0
                    _this.recordsAreLoading = true
                    _this.noRecordsFound = false

                    axios.post('https://query.cityoflewisville.com/v2', {
                        webservice: "Evals_ByType_AuthorizedOnly_GetAll",
                        auth_token: localStorage.colAuthToken,
                        formtype: _formType,
                        employee_email: localStorage.colEmail
                    })
                    .then(function(_results){  
                        if (typeof _results.data[0][0] != 'undefined'){
                            _this.records = _results.data[0]

                            if (_this.records.length == 0){
                                _this.noRecordsFound = true
                            }
                        }else{
                            _this.records.length = 0
                            _this.noRecordsFound = true
                            _this.recordsAreLoading = false
                        }
                        _this.recordsAreLoading = false
                    })
                    .catch(function(error){ 
                        console.error(error)
                        _this.records.length = 0
                        _this.noRecordsFound = true
                        _this.recordsAreLoading = false
                    })
                },
                formatDate: function(_sqlFormattedDateTime){
                    var _this = this
                    return _sqlFormattedDateTime.substr(0,10)
                }                
            },
            computed:{
                formTypePretty: function(){
                    var _this = this
                    var _formTypePretty = 'Unknown'
                    if (_this.formType == 'accomplishments'){ _formTypePretty = 'Accomplishments' }
                    if (_this.formType == 'evaluations'){ _formTypePretty = 'Evaluations' }
                    if (_this.formType == 'self_assessments'){ _formTypePretty = 'Self Assessments' }
                    if (_this.formType == 'supervisor_logs'){ _formTypePretty = 'Supervisor Logs' }
                    return _formTypePretty
                }
            }
        });
        document.addEventListener('DOMContentLoaded', function(){
            app.init()
        })
    </script>
</body>
</html> 